<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Decentralized Voting System
        
    </title><meta content="Decentralized Voting System" property=og:title><meta content="Voting smart contract" property=og:description><meta content="Voting smart contract" name=description><link href=/favicons/favicon.ico rel=icon type=image/png><link href=https://themj0ln1r.github.io/fonts.css rel=stylesheet><script src=https://themj0ln1r.github.io/js/codeblock.js></script><script src=https://themj0ln1r.github.io/js/toc.js></script><script src=https://themj0ln1r.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Charan Nomula" href=https://themj0ln1r.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://themj0ln1r.github.io/theme/light.css rel=stylesheet><link href=https://themj0ln1r.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://themj0ln1r.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://themj0ln1r.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://themj0ln1r.github.io/>Charan Nomula</a><div class=socials><a class=social href=https://x.com/TheMj0ln1r/ rel=me target=_blank> <img alt=twitter src=https://themj0ln1r.github.io/social_icons/twitter.svg> </a><a class=social href=https://linkedin.com/in/mj0ln1r/ rel=me target=_blank> <img alt=linkedin src=https://themj0ln1r.github.io/social_icons/linkedin.svg> </a><a class=social href=https://github.com/TheMj0ln1r/ rel=me target=_blank> <img alt=github src=https://themj0ln1r.github.io/social_icons/github.svg> </a><a href="mailto: playermj0ln1r@gmail.com" class=social rel=me target=_blank> <img alt=Email src=https://themj0ln1r.github.io/social_icons/email.svg> </a></div></div><nav><a href=https://themj0ln1r.github.io/posts style=margin-left:.5em>/posts</a><a href=https://themj0ln1r.github.io/writeups style=margin-left:.5em>/writeups</a><a href=https://themj0ln1r.github.io/projects style=margin-left:.5em>/projects</a><a href=https://themj0ln1r.github.io/contact style=margin-left:.5em>/contact</a><a href=https://themj0ln1r.github.io/tags style=margin-left:.5em>/tags</a> |<a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://themj0ln1r.github.io/feather/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://themj0ln1r.github.io/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>Decentralized Voting System<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2024-01-23</time><span class=tags-label> :: Tags:</span><span class=tags> <a class=post-tag href=https://themj0ln1r.github.io/tags/web3/>web3</a>, <a class=post-tag href=https://themj0ln1r.github.io/tags/defi/>defi</a> </span></div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://themj0ln1r.github.io/projects/votingproject/#decentralized-voting-system>Decentralized Voting System</a> <ul><li><a href=https://themj0ln1r.github.io/projects/votingproject/#design-choices>Design Choices</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#security-considerations>Security Considerations</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#test-cases>Test Cases</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#usage>Usage</a></li><ul><li><a href=https://themj0ln1r.github.io/projects/votingproject/#clone>Clone</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#build>Build</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#test>Test</a><li><a href=https://themj0ln1r.github.io/projects/votingproject/#deploy>Deploy</a></ul></ul></ul></div><section class=body><p>A simple Decentralized Project developed by me for an internship task.<p>Project Repo : <a href=https://github.com/TheMj0ln1r/Decentralized-Voting-System target=_blank>Decentralized Voting Project</a><hr><h1 id=decentralized-voting-system><strong>Decentralized Voting System</strong></h1><p>The system has following features:<ul><li><p>Users can register to vote.</p><li><p>The owner of the contract can add candidates.</p><li><p>Only owner can start an election.</p><li><p>Multiple Elections can be conducted.</p><li><p>Registered voters can cast their votes for a specific candidate.</p><li><p>The voting process should be transparent, and the results should be publicly accessible.</p></ul><h2 id=design-choices>Design Choices</h2><p>The Election contract is designed to manage a simple voting process, with features to register voters and candidates, cast votes, and reveal election results.<p><strong>Access Control:</strong> The contract uses an onlyOwner modifier to restrict certain functions (like registering candidates and revealing results) to the owner of the contract, which is set during contract deployment.<p><strong>Voter Tracking:</strong> Voters are tracked using mappings that associate their addresses with respective Voter. This design allows for efficient lookups and updates.<p><strong>Unique Identifiers:</strong> Both voters and candidates are assigned unique IDs to differentiate them within their respective categories. Vote Casting Mechanism: Voters can cast votes for registered candidates, and the contract ensures that each voter can only vote once.<p><strong>Election Results:</strong> The contract allows the owner to calculate and reveal the winner based on the number of votes each candidate received. The reveal results feature is a bit complex as it supports if the multiple candidates got the same majority.<p><strong>Election Duration:</strong> The contract checks whether the election is active before allowing certain operations (e.g., voter registration, voting). This prevents these operations from occurring outside the specified election duration.<p><strong>Events:</strong> The contract emits events for candidate registration, voter registration, vote casting, and winner declaration, which helps in tracking activities on the blockchain.<p><strong>Error Handling:</strong> The contract uses error messages to clearly communicate the reasons for transaction failures. For example, it raises errors like Election_Not_Owner(), Election_Voter_Already_Registered(), etc. This helps users and developers understand the context of the failure.<p><strong>Time-Based Logic:</strong> The contract uses <code>electionDuration</code> and <code>electionStartTime</code> to manage the duration of the election.<p><strong>Dynamic Arrays</strong>: The <code>candidateDetails</code> array is used to store a dynamic list of <code>Candidate</code> structs. This allows for an arbitrary number of candidates to be registered in the election.<p><strong>State Variables:</strong><p><code>owner</code>: The address of the contract owner.<p><code>totalNumOfVoters</code>: A counter for the total number of registered voters.<p><code>totalNumOfCandidates</code>: A counter for the total number of registered candidates.<p><code>voterDetails</code>: A mapping from voter addresses to Voter structs.<p><code>candidateDetails</code>: A mapping from candidate addresses to Candidate<p><strong>Structs</strong>:<p><code>candidIdToAddr</code>: A mapping from candidate IDs to their addresses. Structs:<p><code>Voter</code>: Contains voter ID and a boolean indicating whether the voter has voted.<p><code>Candidate</code>: Contains candidate ID and the number of votes received.<p><strong>Modifiers</strong>:<p><code>onlyOwner</code>: Restricts function access to the contract owner.<p><strong>Functions</strong>:<p><code>registerVoter</code>(): Allows an address to register as a voter.<p><code>registerCandidate(address _candidate)</code>: Allows the owner to register a new candidate.<p><code>castVote(address _candidate)</code>: Allows a registered voter to cast a vote for a registered candidate.<p><code>revealResults()</code>: Allows the owner to calculate and reveal the winner of the election.<p><code>getMajority(address _candidate)</code>: Returns the number of votes for a given candidate.<p><strong>Events</strong>:<p><code>Election_Candidate_Registered</code>: Emitted when a new candidate is registered.<p><code>Election_Voter_Registered</code>: Emitted when a new voter is registered.<p><code>Election_Voted</code>: Emitted when a vote is cast.<p><code>Election_Winner_Declared</code>: Emitted when the election winner is declared.<p><code>Election_Election_Started</code> : Emitted when election was started by owner.<h2 id=security-considerations>Security Considerations</h2><p>The Election smart contract incorporates several security considerations to protect the integrity of the election process:<p><strong>Access Control:</strong> The contract uses an onlyOwner modifier, which employs a simple authorization check to restrict access to sensitive functions such as registerCandidate and revealResults. This ensures that only the owner can perform certain actions 1.<p><strong>Checks-Effects-Interactions Pattern:</strong> The contract adheres to the Checks-Effects-Interactions pattern by performing checks first (such as verifying if a voter or candidate is already registered), updating the contract state, and then emitting events 13.<p><strong>State Variable Visibility:</strong> State variables such as owner, totalNumOfVoters, and totalNumOfCandidates are declared public, allowing transparency and verification of contract state by external observers 25.<p><strong>Use of Custom Errors:</strong> The contract uses custom error messages for reverting transactions when certain conditions are not met. This helps in reducing gas costs compared to using require with string messages and improves clarity regarding why a transaction failed 1.<pre style=color:#61676c;background-color:#fafafa><code><span>```solidity
</span><span>error Election_Not_Owner();
</span><span>error Election_Voter_Already_Registered();
</span><span>error Election_Candidate_Already_Registered();
</span><span>error Election_Invalid_Candidate();
</span><span>error Election_Already_Voted();
</span><span>error Election_Voter_Not_Registered();
</span><span>error Election_Election_Running();
</span><span>error Election_Election_Completed();
</span><span>error Election_Invalid_Duration();
</span><span>```
</span></code></pre><p><strong>Event Emission:</strong> Events are emitted for key actions such as voter registration, candidate registration, vote casting, and winner declaration. This allows for off-chain monitoring and verification of contract interactions 3.<p><strong>Minimal Use of Loops:</strong> The contract avoids extensive use of loops, which can lead to out-of-gas errors. The only loop present is in the revealResults function, which iterates through candidates to determine the winner. This loop is bound by the number of candidates, which is expected to be a manageable number 13.<p><strong>No External Calls:</strong> The contract does not make external calls to other contracts, which reduces the risk of reentrancy attacks and unexpected interactions with untrusted contracts 12.<p><strong>Immutable Owner:</strong> The owner is set once upon contract deployment and is not changeable. This prevents potential takeover attacks where the ownership could be transferred to a malicious party 1.<p><strong>No Ether Handling:</strong> The contract does not handle Ether transactions, which means there's no risk associated with sending and receiving Ether, nor any need for a fallback function 1.<h2 id=test-cases>Test Cases</h2><p><strong>setUp:</strong> This function initializes the test environment. It creates instances of the Election contract and assigns addresses to voters and candidates.<p><strong>testInitialElectionState:</strong> This test checks the initial state of the Election contract. It asserts that the owner is set correctly, and that the initial number of voters, election duration, and election start time are all zero.<p><strong>testRegisterVoter:</strong> This test verifies the functionality of the registerVoter function. It checks that a voter can be registered, and that attempting to register the same voter twice causes a revert.<p><strong>testRegisterVoterDuringElection:</strong> This test checks that a voter cannot be registered during an election. It attempts to register a voter while an election is running and expects a revert.<p><strong>testRegisterCandidate:</strong> This test verifies the registration of candidates. It checks that a candidate can be registered, that attempting to register the same candidate twice causes a revert, and that attempting to register an invalid candidate also causes a revert.<p><strong>testRegisterCandidateDuringElection:</strong> This test checks that a candidate cannot be registered during an election. It attempts to register a candidate while an election is running and expects a revert.<p><strong>testStartElection</strong>: This test checks the startElection function. It verifies that an election can be started, and that starting an election with an invalid duration causes a revert.<p><strong>testStartElectionAlreadyRunning:</strong> This test verifies that an election cannot be started if another one is already running. It attempts to start an election while another one is running and expects a revert.<p><strong>testCastVote:</strong> This test checks the castVote function. It verifies that a vote can be cast by a registered voter, and that attempting to cast a vote with an unregistered voter or an invalid candidate causes a revert.<p><strong>testGetMajority:</strong> This test checks the getMajority function. It verifies that the majority of votes is calculated correctly for a single candidate.<p><strong>testIsElectionActive:</strong> This test checks the isElectionActive function. It verifies that the function correctly identifies whether an election is currently active.<p><strong>testRevealResults:</strong> This test verifies the revealResults function. It checks that the function correctly declares the winner of an election.<p><strong>testRevealResultsMultipleWinners:</strong> This test checks that the revealResults function correctly handles elections with multiple winners.<p><strong>testRevealResultsNotOwner:</strong> This test checks that the revealResults function can only be called by the owner of the election.<p><strong>testScript:</strong> This test verifies the execution of the ElectionScript. It checks that the script runs successfully and that the Election contract instance it creates is valid.<pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>mj0ln1r@Linux:~/decentralized_voting_system$ forge coverage
</span><span>[⠢] Compiling...
</span><span>[⠊] Compiling 24 files with 0.8.23
</span><span>[⠔] Solc 0.8.23 finished in 7.80s
</span><span>Compiler run successful!
</span><span>Analysing contracts...
</span><span>Running tests...
</span><span>| File                  | % Lines         | % Statements   | % Branches     | % Funcs       |
</span><span>|-----------------------|-----------------|----------------|----------------|---------------|
</span><span>| script/Election.s.sol | 100.00% (3/3)   | 100.00% (3/3)  | 100.00% (0/0)  | 100.00% (1/1) |
</span><span>| src/Election.sol      | 100.00% (55/55) | 96.34% (79/82) | 88.24% (30/34) | 100.00% (7/7) |
</span><span>| Total                 | 100.00% (58/58) | 96.47% (82/85) | 88.24% (30/34) | 100.00% (8/8) |
</span></code></pre><h2 id=usage>Usage</h2><h3 id=clone>Clone</h3><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ git clone 
</span><span>$ cd 
</span></code></pre><h3 id=build>Build</h3><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ forge build
</span></code></pre><h3 id=test>Test</h3><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ forge test
</span></code></pre><h3 id=deploy>Deploy</h3><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ forge script script/Election.s.sol:ElectionScript --rpc-url &LTyour_rpc_url> --private-key &LTyour_private_key>
</span></code></pre></section></article></main></div>